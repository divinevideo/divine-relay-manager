# ABOUTME: Cloudflare Worker for Divine Relay Admin API - PRODUCTION
# ABOUTME: Deploy with: npx wrangler deploy --config wrangler.prod.toml

name = "divine-relay-admin-api-prod"
main = "src/index.ts"
compatibility_date = "2024-12-01"

# Production API route
routes = [
  { pattern = "api-relay-prod.divine.video/*", zone_name = "divine.video" }
]

# The NOSTR_NSEC secret must be set via: wrangler secret put NOSTR_NSEC --config wrangler.prod.toml

[vars]
RELAY_URL = "wss://relay.dvines.org"
# Path for NIP-86 management API (Funnelcake uses /management)
MANAGEMENT_PATH = "/management"
# URL for media moderation service
MODERATION_SERVICE_URL = "https://moderation.admin.divine.video"
# Allow both the main frontend and Cloudflare Pages preview deployments
ALLOWED_ORIGINS = "https://relay.admin.divine.video,*.divine-relay-manager.pages.dev,*.divine-relay-admin.pages.dev"

# D1 Database for moderation decision log (production)
[[d1_databases]]
binding = "DB"
database_name = "divine-moderation-decisions-prod"
database_id = "d000fe55-dfac-4f54-a348-5c57241c2453"