---
title: "6:34:27 PM - December 5, 2025"
date: 2025-12-05T05:34:27.040Z
timestamp: 1764912867040
---

## Project Notes

Completed code review refactoring of ManVRelay moderation components.

**Key changes made:**

1. **adminApi.ts** - Centralized API module:
   - Added HTTP response validation (`response.ok` check before JSON parsing)
   - Added `ApiError` class for proper error handling
   - Added `callRelayRpc()` for NIP-86 RPC calls
   - Added `publishLabel()` for kind 1985 labels
   - Added `publishLabelAndBan()` for combined action
   - Added convenience functions: `banPubkey`, `unbanPubkey`, `listBannedPubkeys`, `listBannedEvents`

2. **Labels.tsx** refactored:
   - Now uses `banPubkey` from adminApi instead of inline fetch
   - Uses `useMutation` for ban actions with loading states
   - Added `AlertDialog` for ban confirmation
   - Fixed type safety issue with namespace filtering (proper type guard)
   - Added query invalidation for banned-users/banned-pubkeys
   - Added toast notifications for success/error

3. **Reports.tsx** refactored:
   - Same improvements as Labels.tsx
   - Uses adminApi for ban actions
   - Added confirmation dialog for bans
   - Removed non-functional "View" button

4. **LabelPublisher.tsx** refactored:
   - Uses `publishLabel` and `publishLabelAndBan` from adminApi
   - Uses proper shadcn `Checkbox` component instead of raw HTML
   - Added JSDoc documentation for DTSP categories and namespaces
   - Proper query invalidation after publish/ban

5. **RelayManager.tsx**:
   - Added ABOUTME header comments

**Patterns established:**
- All API calls go through adminApi.ts
- All mutations use useMutation with proper onSuccess/onError handlers
- All destructive actions (ban) require confirmation dialog
- All ban actions invalidate both 'banned-users' and 'banned-pubkeys' query keys
- All components use toast for user feedback
